# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1
# Use a package of configuration called an orb.

jobs:
  initialize-build:
    docker:
      - image:  circleci/node:8.9.4
    
    steps:
      - checkout
      - run:
          name: Create A Directory
          command: mkdir sfdx
      - run:
          name: Cd Into Directory
          command: cd sfdx

      - run:
          name: Install Salesforce Cli
          command: npm install sfdx-cli --global

      - run:
          name: Decrypt server key
          command:
            #Decrypt server key
            openssl enc -nosalt -aes-256-cbc -d -in assets/server.key.enc -out assets/server.key -base64 -K $DECRYPT_KEY -iv $DECRYPT_IV    
      - run:
          name: Authorize To Target Org
          command: sfdx force:auth:jwt:grant --instanceurl $ENDPOINT --clientid $CLIENT_ID --jwtkeyfile assets/server.key --username $USERNAME  --setalias ProdTest

      - run:
          name: Echo Got Here
          command: echo " We have reached here"        

orbs:
  salesforce-sfdx: circleci/salesforce-sfdx@2.1.0


